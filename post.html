<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bài viết</title>
    <link rel="icon" type="image/x-icon" href="/img/logo.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes fadeUp {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
      }
      .fade-up { animation: fadeUp .6s ease forwards; }
    </style>
  </head>
  <body class="m-0 font-inter text-gray-900 bg-gray-100 min-h-screen flex flex-col">
    <!-- Header -->
    <header id="header" class="fixed top-0 left-0 w-full z-50 bg-white/90 backdrop-blur border-b border-slate-200">
      <div class="max-w-7xl mx-auto flex items-center justify-between px-6 h-14">
        <a href="index.html#home" class="flex items-center gap-3">
          <span class="font-semibold text-gray-800">Tin tức</span>
        </a>
        <nav class="hidden md:flex items-center gap-6 text-sm text-gray-700">
          <a class="hover:text-blue-600" href="index.html#intro">Giới thiệu</a>
          <a class="hover:text-blue-600" href="index.html#history">Lịch sử</a>
          <a class="hover:text-blue-600" href="index.html#culture">Văn hoá</a>
          <a class="hover:text-blue-600" href="index.html#news">Tin tức</a>
        </nav>
      </div>
    </header>

    <!-- Main -->
    <main class="pt-20 pb-16 flex-1">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 fade-up">
        <div class="mb-4 text-sm text-gray-600">
          <a href="index.html#news" class="hover:text-blue-600">← Trang chủ</a>
        </div>
        <article id="reader" class="bg-white rounded-lg border border-slate-200 shadow-sm">
          <div class="p-5 sm:p-8">
            <h1 id="readerTitle" class="text-2xl sm:text-3xl font-bold mb-4 tracking-tight"></h1>
            <div id="readerContent" class="text-base leading-relaxed text-gray-800"></div>
          </div>
        </article>
      </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-200 bg-white">
      <div class="max-w-7xl mx-auto px-6 py-8 text-sm text-gray-600 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
        <div>© <span id="y"></span> THPT Khắc Thừa Dụ. All rights reserved.</div>
      </div>
    </footer>

    <!-- Script -->
<!-- Script -->
<script>
  document.getElementById('y').textContent = new Date().getFullYear();

  function getIdFromQuery() {
    const u = new URL(window.location.href);
    const id = parseInt(u.searchParams.get('id') || '1', 10);
    return isNaN(id) ? 1 : id;
  }

  function escapeHTML(str) {
    return (str || '').replace(/[&<>"']/g, c => ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    }[c]));
  }

  function render(title, content, images) {
    console.log('Render called with:', { title: title?.substring(0, 50) + '...', images }); // Debug: Kiểm tra data truyền vào
    
    const t = document.getElementById('readerTitle');
    const c = document.getElementById('readerContent');
    t.textContent = title || 'Bài viết';
    
    const blocks = (content || '').split(/\r?\n\s*\r?\n/);
    let html = blocks.map(b => `<p class="mb-4">${escapeHTML(b).replace(/\r?\n/g, '<br>')}</p>`).join('');
    
    if (images && images.length > 0) {
      console.log('Rendering images:', images); // Debug: Xác nhận images được xử lý
      const imagesHtml = images.map(img => {
        // Thêm onload/onerror để debug load ảnh
        return `<img src="${escapeHTML(img)}" alt="Hình ảnh bài viết" class="w-full h-auto my-4 rounded-lg shadow-md" 
                onerror="console.error('Image load failed:', '${img}')" 
                onload="console.log('Image loaded:', '${img}')">`;
      }).join('');
      html += `<div class="images-section mt-6">${imagesHtml}</div>`;
      console.log('Images HTML added:', imagesHtml.substring(0, 100) + '...'); // Debug: Xem HTML sinh ra
    } else {
      console.warn('No images to render'); // Debug: Nếu mảng rỗng
    }
    
    c.innerHTML = html || '<p class="text-gray-500">Không có nội dung.</p>';
    console.log('Final HTML:', c.innerHTML.substring(0, 200) + '...'); // Debug: Xem output cuối
  }

  async function load() {
    const id = getIdFromQuery();
    const url = `posts/${id}.txt`;
    console.log('Loading from URL:', url); // Debug: Xác nhận URL

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Not found');
      const data = await res.json();
      console.log('Fetched JSON:', data); // Debug: Toàn bộ data
      render(data.title?.trim(), data.content?.trim(), data.images);
    } catch (e) {
      console.error('Lỗi tải bài viết:', e);
      render('Không tìm thấy bài viết', 'Vui lòng quay lại trang Tin tức.');
    }
  }

  load();
</script>
  </body>
</html>
