<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Giới thiệu Xã Ninh Giang</title>
    <link rel="icon" type="image/x-icon" href="/img/logo.png" />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* --- MENU UNDERLINE ANIMATION --- */

      nav a {
        position: relative;
        text-decoration: none;
      }

      nav a::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 0;
        width: 0%;
        height: 2px;
        background-color: #93c5fd;
        transition: width 0.3s ease;
      }

      nav a:hover::after,
      nav a.active-link::after {
        width: 100%;
      }

      /* --- FADE-UP ANIMATION --- */
      @keyframes fadeUp {
        0% {
          opacity: 0;
          transform: translateY(30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-up {
        animation: fadeUp 1s ease forwards;
      }
      @media (min-width: 1024px) {
        /* chừa không gian sidebar bên phải */
        #intro,
        #history,
        #culture,
        #news {
          margin-right: 22rem;
        }
      }
    </style>
  </head>

  <body class="m-0 font-inter text-white scroll-smooth bg-gray-100">
    <!-- HEADER -->
    <header
      id="header"
      class="fixed top-0 left-0 w-full z-[50] bg-[rgba(255,255,255,0.06)] backdrop-blur-[8px] transition-all duration-300 ease-in-out"
    >
      <div class="max-w-7xl mx-auto flex items-center px-6 h-16">
        <nav
          class="flex-1 flex justify-center items-center space-x-14 mx-4 hidden md:flex"
        >
          <a href="#home" class="text-white font-semibold text-md">Trang chủ</a>
          <a href="#intro" class="text-white font-semibold text-md"
            >Giới thiệu</a
          >
          <a href="#history" class="text-white font-semibold text-md"
            >Lịch sử</a
          >
          <a href="#culture" class="text-white font-semibold text-md"
            >Di tích & Văn hóa</a
          >
          <a href="#news" class="text-white font-semibold text-md"
            >Tin tức & Hoạt động</a
          >
        </nav>
      </div>
    </header>

    <!-- Sidebar: Phụ lục + Tin mới (bên phải) -->
    <aside
      id="tocSidebar"
      class="hidden lg:block fixed top-1/2 right-6 w-80 z-[40] -translate-y-1/2 transform opacity-0 pointer-events-none transition-opacity duration-300"
    >
      <div
        class="bg-white/95 backdrop-blur border border-slate-200 rounded-lg shadow-sm p-4"
      >
        <h3 class="text-base font-semibold text-gray-800 mb-2">Phụ lục</h3>
        <ul class="space-y-1 text-sm">
          <li>
            <a class="text-blue-700 hover:underline" href="#home">Trang chủ</a>
          </li>
          <li>
            <a class="text-blue-700 hover:underline" href="#intro"
              >Giới thiệu</a
            >
          </li>
          <li>
            <a class="text-blue-700 hover:underline" href="#history">Lịch sử</a>
          </li>
          <li>
            <a class="text-blue-700 hover:underline" href="#culture">Văn hoá</a>
          </li>
          <li>
            <a class="text-blue-700 hover:underline" href="#news">Tin tức</a>
          </li>
        </ul>
      </div>
      <div
        class="mt-4 bg-white/95 backdrop-blur border border-slate-200 rounded-lg shadow-sm p-4"
      >
        <h3 class="text-base font-semibold text-gray-800 mb-2">Tin mới</h3>
        <ul id="sidebarNews" class="space-y-2 text-sm text-gray-700"></ul>
      </div>
    </aside>

    <!-- PHẦN 1: TRANG CHỦ -->
    <section
      id="home"
      class="relative flex justify-center text-center before:absolute before:inset-0 before:bg-[rgba(0,0,0,0.45)] before:z-[1] bg-[url('img/schoolbg.jpg')] bg-center bg-cover bg-no-repeat h-[100vh]"
    >
      <div class="relative z-[2] fade-up">
        <img
          src="img/logo.png"
          alt="Logo"
          class="w-28 mb-4 rounded-full shadow-lg mx-auto mt-40"
        />
        <h1 class="text-4xl font-bold my-8 mb-16 section-title">
          Trường THPT Khúc Thừa Dụ
        </h1>
        <a
          href="quiz/quiz.html"
          class="text-md font-semibold px-6 py-3 rounded-xs bg-blue-500 hover:bg-blue-600 transition-colors"
        >
          Làm bài trắc nghiệm
        </a>
      </div>
    </section>

    <!-- PHẦN 2: GIỚI THIỆU -->
    <section
      id="intro"
      class="relative flex justify-center text-gray-800 py-24 bg-white ml-12"
    >
      <div
        class="relative z-[2] fade-up max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-10 px-6"
      >
        <!-- CỘT 1: THÔNG TIN -->
        <div>
          <h1 class="text-3xl font-bold text-sky-700 my-2 section-title">
            Xã Ninh Giang
          </h1>
          <p class="text-gray-600 leading-relaxed my-8">
            Xã Ninh Giang là một đơn vị hành chính mới thuộc thành phố Hải
            Phòng, chính thức được thành lập vào ngày
            <strong>16/06/2025</strong> theo Nghị quyết
            <em>1669/NQ-UBTVQH15</em>. Xã được hình thành từ việc sáp nhập 4 đơn
            vị cũ: thị trấn Ninh Giang, xã Vĩnh Hòa, xã Hồng Dụ và xã Hiệp Lực.
          </p>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-6">
            <div
              class="p-3 rounded-lg bg-gray-50 shadow-sm border border-slate-200"
            >
              <div class="text-sm text-gray-500">Diện tích</div>
              <div class="font-semibold text-gray-800">27.41 km²</div>
            </div>

            <div
              class="p-3 rounded-lg bg-gray-50 shadow-sm border border-slate-200"
            >
              <div class="text-sm text-gray-500">Dân số (01/07/2025)</div>
              <div class="font-semibold text-gray-800">39.535 người</div>
            </div>

            <div
              class="p-3 rounded-lg bg-gray-50 shadow-sm border border-slate-200"
            >
              <div class="text-sm text-gray-500">Mật độ dân số</div>
              <div class="font-semibold text-gray-800">~2.207 người/km²</div>
            </div>

            <div
              class="p-3 rounded-lg bg-gray-50 shadow-sm border border-slate-200"
            >
              <div class="text-sm text-gray-500">Trụ sở UBND</div>
              <div class="font-semibold text-gray-800">
                Đường Lê Thanh Nghị, xã Ninh Giang
              </div>
            </div>
          </div>

          <div
            class="mt-8 text-sm text-gray-500 border-t border-dashed border-slate-200 pt-2"
          >
            <strong>Lưu ý:</strong> Thông tin tổng hợp từ nghị quyết thành lập
            và điều tra dân số.
          </div>
        </div>

        <!-- CỘT 2: HÌNH ẢNH -->
        <div>
          <img
            src="img/hai-phong.jpg"
            alt="Hải Phòng"
            class="w-full object-contain mt-20"
          />
        </div>
      </div>
    </section>

    <!-- PHẦN 3: LỊCH SỬ -->
    <section
      id="history"
      class="relative flex justify-center text-gray-800 py-24 bg-white ml-12"
    >
      <div class="relative z-[2] fade-up max-w-6xl mx-auto px-6">
        <h1
          class="text-3xl font-bold text-sky-700 my-2 text-left mb-8 section-title"
        >
          Lịch sử hình thành
        </h1>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
          <!-- CỘT 1: NỘI DUNG CHI TIẾT -->
          <div class="prose prose-sm max-w-none">
            <p class="text-gray-600 leading-relaxed my-4">
              Vùng đất Ninh Giang ngày nay có lịch sử định cư và phát triển lâu
              đời, với nhiều tên gọi và sự kiện quan trọng qua các triều đại.
            </p>
            <p class="text-gray-600 leading-relaxed my-4">
              <strong>Thời kỳ cổ đại đến thế kỷ X:</strong> Kết quả khảo cổ học
              tại vùng lân cận cho thấy, cư dân đã sinh sống ở vùng đất này từ
              trước Công Nguyên. Vào năm 40, cuộc khởi nghĩa của Hai Bà Trưng
              cũng đã diễn ra ở vùng Hạ Hồng, và tướng Đô Lượng của Hai Bà từng
              đóng quân ở khu vực Hiệp Lực ngày nay. Đầu thế kỷ X, làng Cúc Bồ
              (nay là xã Kiến Quốc) là nơi Khúc Thừa Dụ chiêu binh mã, gây dựng
              cơ nghiệp, mở đầu kỷ nguyên tự chủ.
            </p>
            <p class="text-gray-600 leading-relaxed my-4">
              <strong>Các triều đại phong kiến:</strong> Trước triều Trần, vùng
              đất này thuộc huyện Đồng Lợi. Đời vua Lê Thái Tổ, huyện Đồng Lợi
              được đổi thành Đồng Lại. Dưới thời vua Lê Thánh Tông (1460-1469),
              đơn vị hành chính phủ Hạ Hồng được thành lập, quản lý 4 huyện,
              trong đó có huyện Vĩnh Lại - tiền thân của huyện Ninh Giang sau
              này. Đến năm 1822, vua Minh Mạng đổi tên phủ Hạ Hồng thành phủ
              Ninh Giang, với ý nghĩa là "vùng sông nước an toàn".
            </p>
            <p class="text-gray-600 leading-relaxed my-4">
              <strong>Thời kỳ Pháp thuộc và sau năm 1954:</strong> Năm 1919,
              chính quyền thuộc địa Pháp bỏ cấp phủ, tên gọi Ninh Giang chính
              thức được sử dụng để thay thế cho tên gọi cũ là Vĩnh Lại. Trong
              kháng chiến chống Pháp, Ninh Giang là một quận thuộc tỉnh Vĩnh
              Ninh. Sau năm 1954, huyện Ninh Giang thuộc tỉnh Hải Dương, sau đó
              sáp nhập vào tỉnh Hải Hưng (năm 1968). Ngày 1/4/1979, huyện Ninh
              Giang được sáp nhập với huyện Thanh Miện thành huyện Ninh Thanh,
              đến tháng 3/1996 thì lại được tách ra thành huyện Ninh Giang và
              huyện Thanh Miện như cũ.
            </p>
            <p class="text-gray-600 leading-relaxed my-4">
              <strong>Quá trình chuyển đổi gần đây:</strong> Theo chủ trương sắp
              xếp lại đơn vị hành chính, một xã mới thuộc thành phố Hải Phòng đã
              được thành lập và mang tên xã Ninh Giang. Xã mới này được hình
              thành chủ yếu từ việc sáp nhập thị trấn Ninh Giang và các xã Vĩnh
              Hòa, Hồng Dụ, Hiệp Lực. Việc lựa chọn tên gọi "Ninh Giang" nhằm
              giữ lại những giá trị truyền thống cốt lõi của vùng đất này.
            </p>
          </div>

          <!-- CỘT 2: BẢNG TÓM TẮT -->
          <div>
            <h2 class="text-xl font-bold text-sky-700 mb-4">
              Tóm tắt các mốc lịch sử quan trọng
            </h2>
            <div class="overflow-x-auto">
              <table
                class="min-w-full divide-y divide-gray-200 bg-white shadow-sm border border-slate-200"
              >
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Thời Kỳ
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Sự Kiện / Tên Gọi Chính
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                      Trước thế kỷ X
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                      Cư dân sinh sống từ trước Công nguyên. Gắn liền với khởi
                      nghĩa Hai Bà Trưng (năm 40) và hoạt động của Khúc Thừa Dụ.
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                      Triều Trần về trước
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                      Thuộc huyện Đồng Lợi.
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                      Thời Lê Sơ (1460-1469)
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                      Thành lập phủ Hạ Hồng, quản lý huyện Vĩnh Lại.
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                      Năm 1822
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                      Vua Minh Mạng đổi phủ Hạ Hồng thành phủ Ninh Giang.
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                      Năm 1919
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                      Chính quyền Pháp bỏ cấp phủ, tên gọi Ninh Giang chính thức
                      thay thế cho Vĩnh Lại.
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                      Năm 1979 - 1996
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                      Sáp nhập với huyện Thanh Miện thành huyện Ninh Thanh, sau
                      đó lại tách ra.
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                    >
                      Giai đoạn gần đây
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                      Thành lập xã Ninh Giang thuộc TP. Hải Phòng trên cơ sở sáp
                      nhập các đơn vị hành chính cũ.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="mt-4 text-sm text-gray-500">
              <strong>Lưu ý:</strong> Thông tin tổng hợp từ các tài liệu lịch sử
              và nghị quyết hành chính.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PHẦN 4: DI TÍCH & VĂN HÓA -->
    <section
      id="culture"
      class="relative flex justify-center text-gray-800 py-24 bg-white ml-12"
    >
      <div class="relative z-[2] fade-up max-w-6xl mx-auto px-6">
        <h2
          class="text-3xl font-bold mb-10 text-sky-700 text-center section-title"
        >
          Di tích & Văn hóa
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
          <!-- CỘT 1: DI TÍCH & LỄ HỘI -->
          <div>
            <h3 class="text-xl font-semibold text-sky-700 mb-3">
              Đời sống văn hóa & Lễ hội
            </h3>
            <p class="text-gray-700 leading-relaxed mb-4">
              Đời sống văn hóa tinh thần nơi đây vô cùng phong phú, với nhiều lễ
              hội truyền thống được tổ chức hàng năm. Trong đó, ba di sản đã
              được công nhận là
              <strong>Di sản Văn hóa phi vật thể Quốc gia</strong>:
            </p>

            <!-- <ul class="list-disc list-inside text-gray-700 space-y-1 mb-4">
              <li>
                <a
                  class="hover:underline"
                  href="https://www.vietnamplus.vn/kham-pha-le-hoi-truyen-thong-den-tranh-di-san-van-hoa-phi-vat-the-quoc-gia-post1019564.vnp"
                  target="_blank"
                  >Lễ hội truyền thống Đền Tranh</a
                >
              </li>
            </ul> -->

            <p class="text-gray-700 leading-relaxed mb-3">
              <strong>Lễ hội Đền Tranh</strong> là một trong những lễ hội lớn
              nhất, diễn ra hai kỳ chính trong năm:
            </p>
            <ul class="list-disc list-inside text-gray-700 space-y-1 mb-4">
              <li>
                <strong>Kỳ thứ nhất:</strong> Từ 10 đến 20 tháng 2 Âm lịch
                (trọng hội ngày 14/2 — tương truyền là ngày sinh của Quan lớn).
              </li>
              <li>
                <strong>Kỳ thứ hai:</strong> Từ 10 đến 20 tháng 8 Âm lịch (lễ tạ
                ơn).
              </li>
            </ul>

            <p class="text-gray-700 leading-relaxed mb-3">
              Các nghi lễ và trò chơi dân gian đặc sắc bao gồm: lễ rước nước, lễ
              mộc dục, thi pháo đất, đấu vật, chọi gà, cờ tướng, đi cầu kiều,
              bắt trạch trong chum…
            </p>

            <p class="text-gray-700 leading-relaxed mt-5">
              <strong>Khu di tích tượng đài Chủ tịch Hồ Chí Minh:</strong> nằm
              tại xã Hiệp Lực, là công trình văn hóa có ý nghĩa to lớn gắn với
              sự kiện Bác Hồ về địa phương động viên phong trào chống úng và sản
              xuất. Ngày 26/7/1962, Bác đã cùng bà con nông dân đạp guồng nước
              tại cánh đồng Sao – một hình ảnh lịch sử đầy xúc động.
            </p>
          </div>

          <!-- CỘT 2: LÀNG NGHỀ, ẨM THỰC & HOẠT ĐỘNG -->
          <div>
            <h3 class="text-xl font-semibold text-sky-700 mb-3">
              Làng nghề, Ẩm thực & Hoạt động xã
            </h3>
            <p class="text-gray-700 leading-relaxed mb-4">
              Bên cạnh các giá trị văn hóa tâm linh, Ninh Giang còn nổi tiếng
              với những làng nghề truyền thống và đặc sản ẩm thực mang đậm bản
              sắc quê hương:
            </p>

            <ul class="list-disc list-inside text-gray-700 space-y-2 mb-6">
              <li>
                <strong>Nghề làm bánh gai:</strong> Đặc sản gắn liền với tên
                đất, tên làng, chủ yếu tập trung tại thị trấn Ninh Giang và các
                xã lân cận.
              </li>
              <li>
                <strong>Nghề mộc, chạm khắc:</strong> Tập trung ở thôn Cúc Bồ,
                xã Kiến Quốc, nổi tiếng với các sản phẩm tinh xảo, mang đậm nét
                văn hóa dân gian.
              </li>
              <li>
                <strong>Các chợ phiên truyền thống:</strong> Chợ Vé họp vào các
                ngày 3, 8, 13, 18, 23 và 28 âm lịch, là nơi giao lưu buôn bán
                nhộn nhịp, phản ánh đời sống kinh tế địa phương.
              </li>
            </ul>

            <div class="mt-8 relative">
              <!-- Bỏ h-64 để chiều cao tự tính -->
              <div class="overflow-hidden rounded-lg shadow-md">
                <div
                  id="carousel"
                  class="flex transition-transform duration-500 ease-in-out"
                >
                  <!-- Ảnh: fit ngang, giữ tỷ lệ gốc -->
                  <img
                    src="carousel/banh-gai_HTMH.jpg"
                    alt="Bánh gai HTMH"
                    class="w-full h-auto flex-shrink-0"
                  />
                  <img
                    src="carousel/chove.jpg"
                    alt="Chợ Về"
                    class="w-full h-auto flex-shrink-0"
                  />
                  <img
                    src="carousel/image.jpg"
                    alt="Hình ảnh"
                    class="w-full h-auto flex-shrink-0"
                  />
                  <img
                    src="carousel/img_9372.jpg"
                    alt=""
                    class="w-full h-auto flex-shrink-0"
                  />
                  <img
                    src="carousel/phaodat.jpg"
                    alt=""
                    class="w-full h-auto flex-shrink-0"
                  />
                  <img
                    src="carousel/tuongbac.png"
                    alt=""
                    class="w-full h-auto flex-shrink-0"
                  />
                </div>
              </div>

              <!-- Dots (chấm điều hướng) -->
              <div
                class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2"
              >
                <!-- JS sẽ tạo chấm -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section
      id="news"
      class="relative flex flex-col items-center justify-center text-center bg-white -[100vh] ml-12 h-[100vh]"
    >
      <div class="relative z-[2] fade-up max-w-2xl">
        <h2 class="text-3xl font-bold mb-4 text-sky-700 section-title">
          Tin tức & Hoạt động
        </h2>
      </div>
    </section>

    <!-- SCRIPT Tá»° Äá»˜NG Gáº CH CHÃ‚N + HEADER Äá»”I MÃ€U -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const sections = document.querySelectorAll("section");
        const links = document.querySelectorAll("nav a");
        const header = document.getElementById("header");

        let hideTimeout;

        function activateLink() {
          let currentIndex = -1;

          sections.forEach((section, i) => {
            const rect = section.getBoundingClientRect();
            if (rect.top <= 150 && rect.bottom > 150) {
              currentIndex = i;
            }
          });

          links.forEach((link) => link.classList.remove("active-link"));
          if (currentIndex >= 0) {
            links[currentIndex].classList.add("active-link");
          }

          // Äá»•i mÃ u header khi cuá»™n
          if (window.scrollY > 50) {
            header.classList.add("bg-[rgba(0,0,0,0.3)]", "shadow-md");
            header.classList.remove("bg-[rgba(255,255,255,0.06)]");
          } else {
            header.classList.remove("bg-[rgba(0,0,0,0.3)]", "shadow-md");
            header.classList.add("bg-[rgba(255,255,255,0.06)]");
          }
        }

        function showHeader() {
          header.style.transform = "translateY(0)";
          header.style.transition = "transform 0.4s ease";
        }

        function hideHeader() {
          header.style.transform = "translateY(-100%)";
          header.style.transition = "transform 0.4s ease";
        }

        function startHideTimer() {
          clearTimeout(hideTimeout);
          hideTimeout = setTimeout(() => {
            hideHeader();
          }, 3000);
        }

        // Khi cuá»™n â†’ hiá»‡n header + cáº­p nháº­t active link + Ä‘áº¿m láº¡i 3s
        window.addEventListener("scroll", () => {
          showHeader();
          activateLink();
          startHideTimer();
        });

        // Khá»Ÿi Ä‘á»™ng ban Ä‘áº§u
        activateLink();
        startHideTimer();
      });
    </script>

    <style>
      body.reader-open #header {
        transform: translateY(0) !important;
        transition: none !important;
      }
    </style>

    <!-- Overlay Reader (uses site header above, no hide effect) -->
    <div id="postOverlay" class="fixed inset-0 z-[40] hidden">
      <div class="absolute inset-0 bg-gray-100"></div>
      <div class="relative h-full flex flex-col pt-16">
        <div class="flex-1 overflow-y-auto">
          <div class="max-w-3xl mx-auto px-4 sm:px-6 py-6">
            <article
              id="overlayContent"
              class="max-w-none bg-white p-4 sm:p-6 rounded-lg border border-slate-200 shadow-sm"
            ></article>
            <div class="mt-4 flex justify-end">
              <button
                id="closeOverlayBtn"
                class="text-gray-600 hover:text-gray-900 px-3 py-1 rounded-md border border-gray-300 bg-white"
              >
                Đóng
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Posts loader, cards, pagination, and overlay reader
      document.addEventListener("DOMContentLoaded", () => {
        const POSTS_DIR = "posts";
        const PAGE_SIZE = 4;
        const postsGrid = document.getElementById("postsGrid");
        const paginationEl = document.getElementById("pagination");

        const overlay = document.getElementById("postOverlay");
        const overlayContent = document.getElementById("overlayContent");
        const closeOverlayBtn = document.getElementById("closeOverlayBtn");

        let posts = [];
        let currentPage = 1;

        function ensureContainers() {
          // If postsGrid/pagination don't exist in HTML, inject them under the news section
          if (!postsGrid || !paginationEl) {
            const news = document.getElementById("news");
            if (news) {
              let wrap = news.querySelector("[data-news-wrap]");
              if (!wrap) {
                wrap = document.createElement("div");
                wrap.setAttribute("data-news-wrap", "");
                wrap.className = "max-w-6xl mx-auto px-6 mt-8";
                news.appendChild(wrap);
              }
              const grid =
                document.getElementById("postsGrid") ||
                document.createElement("div");
              grid.id = "postsGrid";
              grid.className =
                "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6";
              if (!grid.parentElement) wrap.appendChild(grid);

              const pager =
                document.getElementById("pagination") ||
                document.createElement("div");
              pager.id = "pagination";
              pager.className =
                "mt-8 flex items-center justify-center gap-2 mb-32";
              if (!pager.parentElement) wrap.appendChild(pager);
            }
          }
        }

        function createCard(post) {
          const card = document.createElement("div");
          card.className =
            "bg-white rounded-lg border border-slate-200 shadow-sm overflow-hidden";
          const href = `post.html?id=${post.id}`;
          card.innerHTML = `
            <a href="${href}" class="block focus:outline-none focus:ring-2 focus:ring-blue-500/50">
              <div class="p-4 flex-1 flex flex-col">
                <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2">${post.title}</h3>
                <p class="text-sm text-gray-600 mb-4 line-clamp-4">${post.excerpt}</p>
                <div class="mt-auto pt-2 text-blue-600 hover:text-blue-800 font-medium">Đọc thêm</div>
              </div>
            </a>
          `;
          return card;
        }

        function renderPagination(total, page) {
          const pagination = document.getElementById("pagination");
          if (!pagination) return;
          pagination.innerHTML = "";
          const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));

          const makeBtn = (label, disabled, onClick, isActive = false) => {
            const btn = document.createElement("button");
            btn.textContent = label;
            btn.className = `px-3 py-1 rounded-md border text-sm ${
              isActive
                ? "bg-blue-600 text-white border-blue-600"
                : "bg-white text-gray-800 border-slate-300 hover:bg-slate-50"
            } ${disabled ? "opacity-50 cursor-not-allowed" : ""}`;
            if (!disabled) btn.addEventListener("click", onClick);
            return btn;
          };

          pagination.appendChild(
            makeBtn("Trước", page <= 1, () => goTo(page - 1))
          );
          for (let p = 1; p <= totalPages; p++) {
            pagination.appendChild(
              makeBtn(String(p), false, () => goTo(p), p === page)
            );
          }
          pagination.appendChild(
            makeBtn("Sau", page >= totalPages, () => goTo(page + 1))
          );
        }

        function renderPage(page) {
          ensureContainers();
          const grid = document.getElementById("postsGrid");
          if (!grid) return;
          grid.innerHTML = "";
          const start = (page - 1) * PAGE_SIZE;
          const slice = posts.slice(start, start + PAGE_SIZE);
          slice.forEach((p) => grid.appendChild(createCard(p)));
          renderPagination(posts.length, page);
        }

        function goTo(page) {
          currentPage = page;
          renderPage(currentPage);
          document
            .getElementById("news")
            ?.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        function escapeHTML(str) {
          return (str || "").replace(
            /[&<>"']/g,
            (c) =>
              ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;",
                "'": "&#39;",
              }[c])
          );
        }

        function renderOverlay(post) {
          const title = escapeHTML(post.title || "BÃ i viáº¿t");
          const content = post.content || "";
          const blocks = content.split(/\r?\n\s*\r?\n/);
          const htmlBlocks = blocks
            .map(
              (b) => `
            <p class="text-gray-700 leading-relaxed mb-4">${escapeHTML(
              b
            ).replace(/\r?\n/g, "<br>")}</p>
          `
            )
            .join("");
          overlayContent.innerHTML = `
            <h1 class="text-2xl font-bold text-gray-900 mb-4">${title}</h1>
            ${htmlBlocks}
          `;
        }

        function openOverlay(post) {
          renderOverlay(post);
          overlay.classList.remove("hidden");
          document.body.classList.add("reader-open");
          document.body.style.overflow = "hidden";
        }

        function closeOverlay() {
          overlay.classList.add("hidden");
          document.body.classList.remove("reader-open");
          document.body.style.overflow = "";
        }

        closeOverlayBtn.addEventListener("click", closeOverlay);
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) closeOverlay();
        });

        async function fetchPost(index) {
          const url = `${POSTS_DIR}/${index}.txt`;
          try {
            const res = await fetch(url);
            if (!res.ok) return null;
            try {
              const data = await res.clone().json();
              const title =
                data.title?.toString().trim() || `BÃ i viáº¿t ${index}`;
              const content = data.content?.toString().trim() || "";
              return normalizePost(index, title, content);
            } catch (_) {
              const text = await res.text();
              const lines = text.split(/\r?\n/);
              const title = (lines.shift() || `BÃ i viáº¿t ${index}`).trim();
              const content = lines.join("\n").trim();
              return normalizePost(index, title, content);
            }
          } catch (err) {
            console.warn("Fetch error for", url, err);
            return null;
          }
        }

        function normalizePost(id, title, content) {
          const excerpt =
            content.length > 180
              ? content.slice(0, 180).trim() + "â€¦"
              : content;
          return { id, title, content, excerpt };
        }

        (async function init() {
          const collected = [];
          for (let i = 1; i <= 50; i++) {
            const p = await fetchPost(i);
            if (!p) break;
            collected.push(p);
          }
          posts = collected;
          // Populate sidebar news (top 5)
          try {
            const list = document.getElementById("sidebarNews");
            if (list) {
              list.innerHTML = posts
                .slice(0, 4)
                .map(
                  (p) =>
                    `<li><a class="text-blue-700 hover:underline" href="post.html?id=${
                      p.id
                    }">${escapeHTML(p.title)}</a></li>`
                )
                .join("");
            }
          } catch (e) {
            console.warn("sidebar news error", e);
          }
          if (posts.length === 0) {
            ensureContainers();
            const grid = document.getElementById("postsGrid");
            if (grid)
              grid.innerHTML =
                '<div class="col-span-full text-center text-gray-600">ChÆ°a cÃ³ bÃ i viáº¿t.</div>';
            return;
          }
          renderPage(currentPage);
        })();
      });
    </script>
    
    <footer class="border-t border-slate-200 bg-white">
      <div
        class="max-w-7xl mx-auto px-6 py-8 text-sm text-gray-600 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between"
      >
        <div>
          © <span id="y2"></span> THPT Khắc Thừa Dụ. All rights reserved.
        </div>
      </div>
    </footer>
    <script>
      document.getElementById("y2").textContent = new Date().getFullYear();
    </script>
    <script>
      // Hiển thị sidebar ở giữa, chỉ khi đã cuộn qua phần home
      document.addEventListener("DOMContentLoaded", function () {
        const toc = document.getElementById("tocSidebar");
        const home = document.getElementById("home");
        if (!toc || !home) return;
        function updateSidebar() {
          const r = home.getBoundingClientRect();
          const headerH = 70; // gần bằng h-16
          if (r.bottom <= headerH) {
            toc.classList.remove("opacity-0", "pointer-events-none");
            toc.classList.add("opacity-100", "pointer-events-auto");
          } else {
            toc.classList.add("opacity-0", "pointer-events-none");
            toc.classList.remove("opacity-100", "pointer-events-auto");
          }
        }
        window.addEventListener("scroll", updateSidebar);
        updateSidebar();
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const carousel = document.getElementById("carousel");
        const images = carousel.querySelectorAll("img");
        const dotContainer =
          carousel.parentElement.parentElement.querySelector(".flex.space-x-2"); // Select the dots container
        let currentIndex = 0;
        const totalImages = images.length;
        const autoPlayInterval = 5000; // 5 seconds

        // Generate dots
        for (let i = 0; i < totalImages; i++) {
          const dot = document.createElement("button");
          dot.className = `w-3 h-3 rounded-full transition-colors duration-300 ${
            i === 0 ? "bg-white" : "bg-gray-400"
          }`;
          dot.addEventListener("click", () => goToSlide(i));
          dotContainer.appendChild(dot);
        }
        const dots = dotContainer.querySelectorAll("button");

        function goToSlide(index) {
          currentIndex = index;
          carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
          dots.forEach((dot, i) => {
            dot.className = `w-3 h-3 rounded-full transition-colors duration-300 ${
              i === currentIndex ? "bg-white" : "bg-gray-400"
            }`;
          });
        }

        function nextSlide() {
          currentIndex = (currentIndex + 1) % totalImages;
          goToSlide(currentIndex);
        }

        // Auto-play
        let autoPlay = setInterval(nextSlide, autoPlayInterval);

        // Pause on hover (optional)
        const carouselContainer = carousel.parentElement;
        carouselContainer.addEventListener("mouseenter", () =>
          clearInterval(autoPlay)
        );
        carouselContainer.addEventListener("mouseleave", () => {
          autoPlay = setInterval(nextSlide, autoPlayInterval);
        });
      });
    </script>
  </body>
</html>
